---
title: "Difference of props hypothesis test"
author: "Schwab"
format: revealjs
editor: visual
execute: 
  echo: true
---

```{r}
#| echo: false
#| include: false

library(tidyverse)
library(Lock5Data)
library(openintro)
library(kableExtra)
library(infer)
```

# Board work

Here is the summary count from the CocaineTreatment dataset from the `Lock5Data` package

```{r}
#| echo: false
#| include: true

CocaineTreatment |>
  filter(Drug %in% c("Desipramine","Placebo"))|>
  count(Drug, Relapse)
```

Make a 90% CI for the difference in proportions between those that relapsed while taking Desipramine vs. the Placebo.

## Oh no! Conditions

Did we check:

-   Independence Extended

-   Success/failure Condition

Let's check them now.

## We could still model with a bootstrap

```{r}
set.seed(2018)

d_hat <- CocaineTreatment |>
  filter(Drug %in% c("Desipramine","Placebo"))|> 
  specify(Relapse ~ Drug, success= "yes") %>%
  calculate(stat = "diff in props")
d_hat

ten_thou_reps <- CocaineTreatment |>
  filter(Drug %in% c("Desipramine","Placebo"))|>
  specify(Relapse ~ Drug, success= "yes") %>%
  #hypothesize(null = "independence") %>%
  generate(reps = 10000) %>%
  calculate(
    stat = "diff in props"
  ) 

```

## Bootstrap sample graph

```{r}
ten_thou_reps |>
  visualize()
```

## Bootstrap CI

```{r}
ten_thou_reps |>
  get_ci(level = 0.90)
```

## Hypothesis Testing for the difference of Proportions.

Let's consider the `mammogram` dataset from open intro.

```{r}
#| echo: false

mammogram |>
  count(treatment, breast_cancer_death)|>
  kable(booktabs = TRUE)
```

Test to see if proportions of deaths by women who used mammogram vs non-mammogram screening for BC are different.

## Test with a difference of Proportions

-   Check conditions

-   Null Hypothesis

-   Set up distribution for the difference in props.

-   Find the p-value of from your point estimate. ($\hat{p}_1 - \hat{p}_2$ )

-   Conclusion.

## Pooled $\hat{p}$

The SE for a hypothesis test for a difference in two proportions is different than for a CI.

 

$SE = \sqrt{\frac{\hat{p}_{pool}(1−\hat{p}_{pool})}{n_1} +\frac{\hat{p}_{pool}(1−\hat{p}_{pool})}{n_2}})$

 

Where $\hat{p}_{pool} = \frac{\text{number of successes}}{\text{number of cases}}$

## Make conclusion

Also consider the type of error that may have occurred.

![](gfx/test_errors.png)

## Try this one:

Quebec and Texas are always threatening to secede their respective countries. In a poll of 800 Quebecers found the 28% thought that Quebec should secede. In a poll of 500 Texans 18% of them thought they should secede.

 

Construct a hypothesis test to see if there is evidence that the population proportions are different.

 

This problem is from 6.197 in the Lock5 "Unlocking the power of Data" 1st edition
