---
title: "Many Proportions"
author: "Schwab"
format: 
  revealjs:
    theme: beige
editor: visual
execute: 
  echo: true
---

## More than two proportions

If we have more than two proportions we have a special testing using the chi-squared distribution $\chi_{df}^2$ . This distribution takes what is called degrees of freedom and its shape changes depending on the degrees of freedom.

## When?

Consider the `assortative_mating` data from open intro, specifically the columns `self_male` and `partner_female.`We might be interesting in asking the question: " Does the color of a person's eyes tell us something about the color of their mate's eyes?" In other words: Is eye color independent of one's mate's eye color?

```{r}
library(tidyverse)
library(openintro)

assortative_mating |> head()
```

## Table

```{r}
library(kableExtra)
addmargins( 
  assortative_mating|>
    table()
  )
```

## Degrees of Freedom

If I tell you every value in the table except 1, you can figure it out. The same is true for two or three numbers. But if I leave off 4 numbers you'll have an impossible time figuring them out. So this situation has 4 degrees of freedom.

$$
df=(r-1)(c-1)
$$

Where r and c are the rows and columns (without the margins).

## The chi square distribution

This is the chi-square distributions for 4 degrees of freedom.

```{r}
# Have r generate 100 values for chi square
curve(
  dchisq(x, df = 4), 
  from = 0, to = 10
  )
```

## Our Hypothesis:

$$
H_0: \text{Eye color independent of partner's eye color?} \\
H_A: \text{Eye color not independent of partner's eye color?}
$$

$$
\alpha = 0.05
$$

## Conditions:

-   Independent observations

-   Large samples: 5 expected counts in each cell

## The test statistic

We use the test statistic to calculate the pvalue and complete our test. For this test it is synonymous with the observed statistic.

$$
\chi^2 = \sum_{i,j} \frac{(\text{observed}-\text{expected})^2 }{\text{expected}}
$$

## Find the test stat by hand

## Find the test stat with R

```{r}
library(infer)

# To find the statistic
observed_stat <- observe(
  assortative_mating, 
  explanatory = self_male, 
  response = partner_female, 
  stat = "Chisq") |> 
  # Pull() is to get a value out of a df. 
  pull()

pchisq(q= observed_stat, df=4, lower.tail = FALSE)

#Or to do the whole test
chisq_test(assortative_mating, explanatory = self_male, response = partner_female)
```

## Try one:

Problem

1a by hand on the board, then do a hypothesis test to see if there is independence between being able to quit smoking and a support group.
