---
title: "Linear Regression CI and Randomization"
author: "Schwab"
format: html
editor: visual
execute: 
  echo: true
---

## Libraries

```{r}
library(openintro)
library(tidyverse)
library(infer)
library(broom)
```

## Recall

```{r}
starbucks |>
  ggplot(aes(x=fat, y= calories))+
  geom_point()+
  geom_smooth(method = "lm", se = FALSE)+
  labs(title ="Correlation between fat and calories of starbucks items")
```

## Hypothesis

$$
H_0 : \beta_1 =0 \\ H_a: \beta_1 \ne 0
$$

## Linear Model

```{r}
star_model <- lm(calories ~ fat, data= starbucks) 
star_model |> tidy()
```

## Confidence Interval for slope

We could also find this by hand.

```{r}
star_model <- lm(calories ~ fat, data= starbucks) 
star_model |> tidy(conf.level = 0.95, conf.int = TRUE)
```

## Randomization Distribution

```{r}
#| echo: FALSE
set.seed(12042023)

starbucks |>
   specify(calories ~ fat) |>
   hypothesize(null = "independence") |>
   generate(reps = 2, type = "permute") |>
   ggplot(aes(x=fat, y= calories))+
  geom_point()+
  geom_smooth(method = "lm", se= FALSE)+
  facet_wrap(~replicate)
```

## What is permute doing?

Its keeps the same values but mixes the x and y.

Draw picture on board.

Why do we want this?

::: incremental
-   Because $H_0: \beta_1 = 0$

-   It gives us a picture of what the data would look like if the null is true.
:::

## Do our hypothesis test.

Make 1000 permuted samples

```{r}
set.seed(12042023)

starbucks_1000 <- starbucks |>
   specify(calories ~ fat) |>
   hypothesize(null = "independence") |>
   generate(reps = 1000, type = "permute") |>
   calculate(stat = "slope")
```

## Graph them to check shape

The randomization distribution looks like a t distribution (or a normal)

```{r}
starbucks_1000 |>
  visualise()
```

## The t-score from our test.

```{r}
star_model <- lm(calories ~ fat, data= starbucks) 
star_model |> tidy()
 
sb_t_score <- 11.26651
```

## p-value on graph.

```{r}
starbucks_1000 |>
  visualise()+
  shade_p_value(obs_stat = sb_t_score, direction= "greater")
```

## Conclusion

It seems unlikely that the slope is zero and we reject the null hypothesis.

Fat is a reasonable predictor of calories.

## Use simulation to check protein and fiber?

Is protein a good predictor of fiber?

```{r}
starbucks |>
  ggplot(aes(x=protein, y= fat))+
  geom_point()+
  geom_smooth(method = "lm", se = FALSE)+
  labs(title ="Correlation between fat and calories of starbucks items")
```
